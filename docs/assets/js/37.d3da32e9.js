(window.webpackJsonp=window.webpackJsonp||[]).push([[37],{471:function(t,e,a){"use strict";a.r(e);var s=a(65),n=Object(s.a)({},(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"page-title"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#page-title"}},[t._v("#")]),t._v(" "+t._s(t.$page.title))]),t._v(" "),a("p",[t._v(t._s(t.$page.frontmatter.excerpt))]),t._v(" "),a("p",[t._v("Your favorite programming language is missing? "),a("a",{attrs:{href:"https://vc.hub.msg.team/huethm/web-security-workbook",target:"_blank",rel:"noopener noreferrer"}},[t._v("Add it yourself!"),a("OutboundLink")],1)]),t._v(" "),a("Badge",{attrs:{text:t.$page.frontmatter.owasp}}),t._v(" "),a("h2",{attrs:{id:"background"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#background"}},[t._v("#")]),t._v(" Background")]),t._v(" "),a("h3",{attrs:{id:"context"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#context"}},[t._v("#")]),t._v(" Context")]),t._v(" "),a("p",[t._v("In Java, objects can be serialized (object into bytes) and deserialized (bytes into object). The "),a("em",[t._v("Serializable()")]),t._v(" interface and its "),a("em",[t._v("readObject()")]),t._v(" and "),a("em",[t._v("writeObject()")]),t._v(" methods must be used to make an object serializable. The "),a("em",[t._v("ObjectInputStream.readObject()")]),t._v(" function starts the deserialization process and executes the corresponding "),a("em",[t._v("readObject()")]),t._v(" method.")]),t._v(" "),a("h3",{attrs:{id:"problems"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#problems"}},[t._v("#")]),t._v(" Problems")]),t._v(" "),a("ul",[a("li",[a("strong",[t._v("Attacker can recognize serialized objects easily")]),t._v(" "),a("ul",[a("li",[t._v("Through the first characters\n"),a("ul",[a("li",[t._v("In hexadezimal: "),a("em",[t._v("aced")])]),t._v(" "),a("li",[t._v("In base64: "),a("em",[t._v("rO0")])])])]),t._v(" "),a("li",[t._v("Or through the "),a("em",[t._v("application/x-java-serialized-object")]),t._v(" configuration of the "),a("em",[t._v("Content-type")]),t._v(" HTTP header")])])]),t._v(" "),a("li",[a("strong",[t._v("Type casting after executed ater the serialization")]),t._v(" "),a("ul",[a("li",[t._v("Java always deserializes the objects if the corresponding class was found within the project")]),t._v(" "),a("li",[t._v("Attackers can make use of potentially dangerous "),a("em",[t._v("readObject")]),t._v(" methods (see code example below) to execute commandos")]),t._v(" "),a("li",[t._v("Type casting error is thrown after the class constructor is already executed")])])])]),t._v(" "),a("div",{staticClass:"language-java extra-class"},[a("pre",{pre:!0,attrs:{class:"language-java"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("class")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ExploitClass")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("implements")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Serializable")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("private")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("readObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token class-name"}},[a("span",{pre:!0,attrs:{class:"token namespace"}},[t._v("java"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("io"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")])]),t._v("ObjectInputStream")]),t._v(" in"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" \n        "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("throws")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("IOException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("ClassNotFoundException")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        in"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("defaultReadObject")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Runtime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("getRuntime")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("exec")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("command"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")])])])]),a("h3",{attrs:{id:"solutions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#solutions"}},[t._v("#")]),t._v(" Solutions")]),t._v(" "),a("ul",[a("li",[t._v("To secure the deserialization a "),a("strong",[t._v('"Look Ahead Approach"')]),t._v(" is required\n"),a("ul",[a("li",[t._v("The object's class is evaluated "),a("strong",[t._v("before")]),t._v(" the creation process is started")])])]),t._v(" "),a("li",[t._v("Serialized objects could be encrypted to only allow correctly encrypted ones to be deserialized")])]),t._v(" "),a("h2",{attrs:{id:"technology"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#technology"}},[t._v("#")]),t._v(" Technology")]),t._v(" "),a("p",[t._v("How to secure deserialization in Java can be found in this "),a("a",{attrs:{href:"https://github.com/moritzhuether/mastersthesis/tree/main/GeneralJava/08-InsecureDeserialization/main/src/main",target:"_blank",rel:"noopener noreferrer"}},[t._v("code example"),a("OutboundLink")],1),t._v(".")]),t._v(" "),a("h3",{attrs:{id:"java"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#java"}},[t._v("#")]),t._v(" Java")]),t._v(" "),a("p",[t._v("The library "),a("a",{attrs:{href:"https://github.com/ikkisoft/SerialKiller",target:"_blank",rel:"noopener noreferrer"}},[t._v("Serial Killer"),a("OutboundLink")],1),t._v(" can be used, however its usage is "),a("strong",[t._v("not")]),t._v(" recommended because of its complicated configuration file.")]),t._v(" "),a("table",[a("thead",[a("tr",[a("th",[t._v("Library")]),t._v(" "),a("th",[t._v("Solution")])])]),t._v(" "),a("tbody",[a("tr",[a("td",[t._v("Java only")]),t._v(" "),a("td",[t._v('"Look Ahead" '),a("a",{attrs:{href:"https://github.com/moritzhuether/mastersthesis/blob/main/GeneralJava/08-InsecureDeserialization/main/src/main/LookAheadObjectInputStream.java",target:"_blank",rel:"noopener noreferrer"}},[t._v("custom implementation"),a("OutboundLink")],1)])]),t._v(" "),a("tr",[a("td",[t._v("Serial Killer")]),t._v(" "),a("td",[t._v("Configuration of a white- and blacklist of allowed classes")])]),t._v(" "),a("tr",[a("td",[t._v("Apache Commons IO")]),t._v(" "),a("td",[a("em",[t._v("ValidatingObjectInputStream")]),t._v(" objekc requires array of allowed classes before deserialization")])])])])],1)}),[],!1,null,null,null);e.default=n.exports}}]);