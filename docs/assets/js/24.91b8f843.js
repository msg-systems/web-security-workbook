(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{457:function(e,t,a){"use strict";a.r(t);var s=a(65),r=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"page-title"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#page-title"}},[e._v("#")]),e._v(" "+e._s(e.$page.title))]),e._v(" "),a("p",[e._v(e._s(e.$page.frontmatter.excerpt))]),e._v(" "),a("Badge",{attrs:{text:e.$page.frontmatter.owasp}}),e._v(" "),a("h2",{attrs:{id:"background"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#background"}},[e._v("#")]),e._v(" Background")]),e._v(" "),a("h3",{attrs:{id:"context"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#context"}},[e._v("#")]),e._v(" Context")]),e._v(" "),a("p",[e._v("Injection attacks are possible if database queries are created based on user input. Consequently, the user gains control over the behavior of the query through the added code or commands. The best known types of such an injection are SQL injections, which take place on relational databases such as MySQL, and NoSQL injections which can happen in a variety of databases such as MongoDB or Redis.")]),e._v(" "),a("p",[e._v("The following mechanisms were defined to inject code into databases:")]),e._v(" "),a("ul",[a("li",[e._v("User input")]),e._v(" "),a("li",[e._v("Cookies")]),e._v(" "),a("li",[e._v("Server variables")]),e._v(" "),a("li",[e._v("Second-order injections (execution of injection is postponed)")])]),e._v(" "),a("h4",{attrs:{id:"sql-injection"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#sql-injection"}},[e._v("#")]),e._v(" SQL Injection")]),e._v(" "),a("p",[e._v("In SQL injections attackers inject data into SQL queries to change their outcome. An example can be seen in the following:")]),e._v(" "),a("p",[e._v("@"),a("a",{attrs:{href:"@/vpr/owasp2021/A3-Injection/scripts/SQLinjection-example.js"}},[e._v("code")])]),e._v(" "),a("p",[e._v("The user input (2. String) is concatenated to the SQL query without further escaping and therefore changes the query's outcome. The induced behaviour causes the WHERE clause to always be true and thus always return all users.")]),e._v(" "),a("p",[e._v("In the literature different types of SQL injections could be elaborated:")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Type")]),e._v(" "),a("th",[e._v("Example")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("Tautologies")]),e._v(" "),a("td",[e._v("OR 1 = 1")])]),e._v(" "),a("tr",[a("td",[e._v("Union queries")]),e._v(" "),a("td",[e._v("; UNION SELECT * FROM SecretTable")])]),e._v(" "),a("tr",[a("td",[e._v("Piggyback queries")]),e._v(" "),a("td",[e._v("; DROP SecretTable")])]),e._v(" "),a("tr",[a("td",[e._v("Incorrect queries")]),e._v(" "),a("td",[e._v("OR OR OR OR")])]),e._v(" "),a("tr",[a("td",[e._v("Extending queries")]),e._v(" "),a("td",[e._v("sqlcmd")])])])]),e._v(" "),a("h4",{attrs:{id:"nosql-injection"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#nosql-injection"}},[e._v("#")]),e._v(" NoSQL Injection")]),e._v(" "),a("p",[e._v("A NoSQL injection functions similar to a SQL injection. An example can be seen in the following:")]),e._v(" "),a("p",[e._v("@"),a("a",{attrs:{href:"@/vpr/owasp2021/A3-Injection/scripts/noSQLinjection-example.js"}},[e._v("code")])]),e._v(" "),a("p",[e._v("The query searches for all titles within its collection which are not equal to an empty string. The resulting dataset contains all titles.")]),e._v(" "),a("p",[e._v("Different types of NoSQL injections exist. However, these are again similar to the SQL injection types:")]),e._v(" "),a("table",[a("thead",[a("tr",[a("th",[e._v("Type")]),e._v(" "),a("th",[e._v("Example")])])]),e._v(" "),a("tbody",[a("tr",[a("td",[e._v("Operator injections (creates e.g. tautologies)")]),e._v(" "),a("td",[e._v("{$ne: {''}}")])]),e._v(" "),a("tr",[a("td",[e._v("JavaScript injections (creates e.g. tautologies)")]),e._v(" "),a("td",[e._v('$where: "..."')])]),e._v(" "),a("tr",[a("td",[e._v("Piggyback queries")]),e._v(" "),a("td",[e._v('"$or"')])])])]),e._v(" "),a("h3",{attrs:{id:"issues"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#issues"}},[e._v("#")]),e._v(" Issues")]),e._v(" "),a("ul",[a("li",[e._v("Data could be stolen through attacks which use tautologies or piggyback injections")]),e._v(" "),a("li",[e._v("Data could also be lost or changed to the advantage of the attacker (elevation of privilege)")]),e._v(" "),a("li",[e._v("Successful attacks can not only attack databases but also their underlying systems and infrastructure")])]),e._v(" "),a("h3",{attrs:{id:"solutions"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#solutions"}},[e._v("#")]),e._v(" Solutions")]),e._v(" "),a("ul",[a("li",[e._v("Parameterized queries (e.g. via ORMs)")]),e._v(" "),a("li",[e._v("Usage of secure APIs")]),e._v(" "),a("li",[e._v("Escaping or sanitization ("),a("a",{attrs:{href:"https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html",target:"_blank",rel:"noopener noreferrer"}},[e._v("OWASP SQL Injection Cheat Sheet"),a("OutboundLink")],1),e._v(")")]),e._v(" "),a("li",[e._v("Using of client-directed queries (GraphQL)")])]),e._v(" "),a("h2",{attrs:{id:"technology"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#technology"}},[e._v("#")]),e._v(" Technology")]),e._v(" "),a("p",[e._v("To connect a framework with a database, the usage of a library is most often indispensable. These libraries will be evaluated in the following.")]),e._v(" "),a("p",[e._v("Your favorite framework/library/database is missing? "),a("a",{attrs:{href:"https://websecurityworkbook.com",target:"_blank",rel:"noopener noreferrer"}},[e._v("Add it yourself!"),a("OutboundLink")],1)]),e._v(" "),a("h3",{attrs:{id:"express"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#express"}},[e._v("#")]),e._v(" Express")]),e._v(" "),a("h4",{attrs:{id:"mysql-database"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-database"}},[e._v("#")]),e._v(" MySQL database")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://www.npmjs.com/package/mysql",target:"_blank",rel:"noopener noreferrer"}},[e._v("mysql"),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("The library "),a("em",[e._v("mysql")]),e._v(" can be used to connect an Express server with and MySQL database. The following shows recommended querying of data:")]),e._v(" "),a("p",[e._v("@"),a("a",{attrs:{href:"@/vpr/owasp2021/A3-Injection/scripts/mysql-example.js"}},[e._v("code")])]),e._v(" "),a("div",{staticClass:"custom-block tip"},[a("p",{staticClass:"custom-block-title"},[e._v("TIP")]),e._v(" "),a("ul",[a("li",[e._v("The "),a("em",[e._v("escape()")]),e._v(" Methode escapes potentially dangerous code\n"),a("ul",[a("li",[a("em",[e._v("NO_BACKSLASH_ESCAPE")]),e._v(" needs to be disabled, otherwise the backslash character cannot be used for escaping")])])]),e._v(" "),a("li",[e._v("? are placeholder for user input which is escaped before its added to the SQL query")])])]),e._v(" "),a("p",[a("a",{attrs:{href:"https://www.npmjs.com/package/sequelize",target:"_blank",rel:"noopener noreferrer"}},[e._v("Sequelize"),a("OutboundLink")],1)]),e._v(" "),a("p",[a("em",[e._v("Sequelize")]),e._v(" is "),a("a",{attrs:{href:"https://www.npmjs.com/search?q=orm",target:"_blank",rel:"noopener noreferrer"}},[e._v("one of many ORMs"),a("OutboundLink")],1),e._v(" which are available on "),a("a",{attrs:{href:"https://www.npmjs.com/",target:"_blank",rel:"noopener noreferrer"}},[e._v("npmjs"),a("OutboundLink")],1),e._v(". ORMs function through the definition of a model which represents data inside of the database. Therefore, parameters, which are passed to the database, can be given a datatype to which the parameter is parsed to.")]),e._v(" "),a("p",[a("strong",[e._v("As a result, queries are secure.")])]),e._v(" "),a("p",[e._v("@"),a("a",{attrs:{href:"@/vpr/owasp2021/A3-Injection/scripts/sequelize-example.js"}},[e._v("code")])]),e._v(" "),a("h4",{attrs:{id:"mongodb-database"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-database"}},[e._v("#")]),e._v(" MongoDB database")]),e._v(" "),a("p",[e._v("When working with MongoDB, the most common libraries are "),a("a",{attrs:{href:"https://www.npmjs.com/package/mongodb",target:"_blank",rel:"noopener noreferrer"}},[e._v("mongodb"),a("OutboundLink")],1),e._v(" and "),a("a",{attrs:{href:"https://www.npmjs.com/package/mongoose",target:"_blank",rel:"noopener noreferrer"}},[e._v("mongoose"),a("OutboundLink")],1),e._v(" (ORM).")]),e._v(" "),a("div",{staticClass:"custom-block danger"},[a("p",{staticClass:"custom-block-title"},[e._v("DANGER")]),e._v(" "),a("p",[a("strong",[e._v("The usage is insecure if no sanitization library is used. Attacks possible through "),a("RouterLink",{attrs:{to:"/owasp2021/A3-Injection/#context"}},[e._v("operator injections")]),e._v(".")],1)])]),e._v(" "),a("p",[a("strong",[e._v("Solution:")]),e._v(" The usage of sanitization libraries such as "),a("a",{attrs:{href:"https://www.npmjs.com/package/express-mongo-sanitize",target:"_blank",rel:"noopener noreferrer"}},[e._v("express-mongo-sanitize"),a("OutboundLink")],1),e._v(" or "),a("a",{attrs:{href:"https://www.npmjs.com/package/mongo-sanitize",target:"_blank",rel:"noopener noreferrer"}},[e._v("mongo-sanitize"),a("OutboundLink")],1),e._v(". The former prior library is the preferred choice since it functions with Express' middleware and adds therefore more Security By Default.")]),e._v(" "),a("h3",{attrs:{id:"spring-boot"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#spring-boot"}},[e._v("#")]),e._v(" Spring Boot")]),e._v(" "),a("h4",{attrs:{id:"mysql-database-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mysql-database-2"}},[e._v("#")]),e._v(" MySQL database")]),e._v(" "),a("p",[e._v("In Java, different ways of querying data from a MySQL database exist. Both Java's "),a("code",[e._v("mysql-connector-java")]),e._v(" and Spring's "),a("code",[e._v("spring-boot-starter-data-jdbc")]),e._v(" offer secure data querying with "),a("code",[e._v("PreparedStatement")]),e._v("'s or "),a("code",[e._v("NamedParameterJdbcTemplate")]),e._v("'s. However, queries can also be created insecurely. In contrast, "),a("code",[e._v("spring-boot-starter-data-jpa")]),e._v(" can be used as ORM by defining "),a("code",[e._v("Entity")]),e._v(" classes making the queries secure.")]),e._v(" "),a("h4",{attrs:{id:"mongodb-database-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mongodb-database-2"}},[e._v("#")]),e._v(" MongoDB database")]),e._v(" "),a("p",[e._v("When using MongoDB as underlying database, a Spring Boot developer will most likely use "),a("code",[e._v("spring-boot-starter-data-jpa")]),e._v(". While testing and researching for potential security issues, none were found.")])],1)}),[],!1,null,null,null);t.default=r.exports}}]);