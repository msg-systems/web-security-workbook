<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>JSON Web Token (JWT) | Web Security Workbook</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo.svg">
    <meta name="description" content="Workbook for secure web-applications">
    
    <link rel="preload" href="/assets/css/0.styles.e58af61c.css" as="style"><link rel="preload" href="/assets/js/app.092ee17f.js" as="script"><link rel="preload" href="/assets/js/2.480740af.js" as="script"><link rel="preload" href="/assets/js/31.788e2c0c.js" as="script"><link rel="preload" href="/assets/js/4.6976baea.js" as="script"><link rel="prefetch" href="/assets/js/10.59739b1d.js"><link rel="prefetch" href="/assets/js/11.53d5a4dd.js"><link rel="prefetch" href="/assets/js/12.c0593824.js"><link rel="prefetch" href="/assets/js/13.534c8225.js"><link rel="prefetch" href="/assets/js/14.2e42915a.js"><link rel="prefetch" href="/assets/js/15.233363a8.js"><link rel="prefetch" href="/assets/js/16.e355692a.js"><link rel="prefetch" href="/assets/js/17.1576f434.js"><link rel="prefetch" href="/assets/js/18.760b7ef7.js"><link rel="prefetch" href="/assets/js/19.aaa2f77f.js"><link rel="prefetch" href="/assets/js/20.20fba911.js"><link rel="prefetch" href="/assets/js/21.290166de.js"><link rel="prefetch" href="/assets/js/22.e5701877.js"><link rel="prefetch" href="/assets/js/23.32f6ff8e.js"><link rel="prefetch" href="/assets/js/24.f4f1ed6b.js"><link rel="prefetch" href="/assets/js/25.7dc4ef7b.js"><link rel="prefetch" href="/assets/js/26.e3fd7635.js"><link rel="prefetch" href="/assets/js/27.4c4dd822.js"><link rel="prefetch" href="/assets/js/28.352f2a7d.js"><link rel="prefetch" href="/assets/js/29.1f419205.js"><link rel="prefetch" href="/assets/js/3.2d28240e.js"><link rel="prefetch" href="/assets/js/30.3f41ed43.js"><link rel="prefetch" href="/assets/js/32.d16bc3c5.js"><link rel="prefetch" href="/assets/js/33.87c3647e.js"><link rel="prefetch" href="/assets/js/34.39e88613.js"><link rel="prefetch" href="/assets/js/35.b1bfc54d.js"><link rel="prefetch" href="/assets/js/36.2561ac02.js"><link rel="prefetch" href="/assets/js/37.f36b2ffc.js"><link rel="prefetch" href="/assets/js/38.406c5ee8.js"><link rel="prefetch" href="/assets/js/39.0dccd049.js"><link rel="prefetch" href="/assets/js/40.e9eeabbd.js"><link rel="prefetch" href="/assets/js/5.848d0eb8.js"><link rel="prefetch" href="/assets/js/6.09ebf8e6.js"><link rel="prefetch" href="/assets/js/7.43b93d5e.js"><link rel="prefetch" href="/assets/js/8.50f3aba0.js"><link rel="prefetch" href="/assets/js/9.afb7cb3c.js">
    <link rel="stylesheet" href="/assets/css/0.styles.e58af61c.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.svg" alt="Web Security Workbook" class="logo"> <span class="site-name can-hide">Web Security Workbook</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/owasp2021/" class="nav-link router-link-active">
  OWASP 2021
</a></div><div class="nav-item"><a href="/general/" class="nav-link">
  General
</a></div><div class="nav-item"><a href="/codeExamples.html" class="nav-link">
  Code Examples
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/owasp2021/" class="nav-link router-link-active">
  OWASP 2021
</a></div><div class="nav-item"><a href="/general/" class="nav-link">
  General
</a></div><div class="nav-item"><a href="/codeExamples.html" class="nav-link">
  Code Examples
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/owasp2021/" aria-current="page" class="sidebar-link">OWASP Top 10 2021</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>A1: Broken Access Control</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>A2: Cryptographic Failures</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>A3: Injection</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>A4: Insecure Design</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>A5: Security Misconfiguration</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>A6: Vulnerable and Outdated Components</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>A7: Identification and Authentication Failures</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/owasp2021/A7-IdentificationAndAuthenticationFailures/" aria-current="page" class="sidebar-link">General Information</a></li><li><a href="/owasp2021/A7-IdentificationAndAuthenticationFailures/jsonWebToken.html" aria-current="page" class="active sidebar-link">JSON Web Token (JWT)</a></li><li><a href="/owasp2021/A7-IdentificationAndAuthenticationFailures/passwordHashing.html" class="sidebar-link">Passwort Hashing</a></li><li><a href="/owasp2021/A7-IdentificationAndAuthenticationFailures/passwordPolicy.html" class="sidebar-link">Password Policies</a></li><li><a href="/owasp2021/A7-IdentificationAndAuthenticationFailures/sessionCookies.html" class="sidebar-link">Session Cookies</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>A8: Software and Data Integrity Failures</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>A9: Security Logging and Monitoring Failures</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>A10: Server-Side Request Forgery (SSRF)</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="page-title"><a href="#page-title" class="header-anchor">#</a> JSON Web Token (JWT)</h1> <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>A07:2021</span> <h2 id="background"><a href="#background" class="header-anchor">#</a> Background</h2> <h3 id="context"><a href="#context" class="header-anchor">#</a> Context</h3> <p>JTWs are a standard that is defined in <a href="https://datatracker.ietf.org/doc/html/rfc7519" target="_blank" rel="noopener noreferrer">RFC 7519<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>. The token consists of a header, a payload and a signature. Within its header, metainformation about the token, such as the used hashing algorithm or the type of the JWT. Its payload carries data that is required by the application. Both of these components are Base64 encoded and concatenated with a dot. This string is not only used to start the JWT but also used in the signature in which a HMAC function is used to create a hash of it. The resulting hash is concatenated to the above mentioned string.</p> <h3 id="problems"><a href="#problems" class="header-anchor">#</a> Problems</h3> <ol><li><strong>In case the validation is influenced by the <code>alg</code> attribute, an attacker can dodge the validation or manipulate it.</strong> <ul><li>Insecure libraries except <code>none</code> as algorithm, causing the JWT to always be valid.</li> <li>Also allows the forging of new JWTs if for example RSA was used for encryption.
<ul><li>Attackers switch from RSA to HMAC and encrypt a new token with the public key used in RSA</li> <li>The library now switches from RSA to HMAC because of the changed header and uses the public key as secret</li> <li>The token is valid because the attacker used the public key to encrypt the token</li></ul></li></ul></li> <li><strong>Storing of JWTs is not included in the standard</strong></li> <li><strong>Tokens cannot be revoked</strong> <ul><li>Implementation of token blacklist is possible but then session cookies can be used instead</li></ul></li> <li><strong>Stolen JWTs (trough for example XSS) can therefore be used to authenticate requests</strong></li></ol> <h3 id="solution"><a href="#solution" class="header-anchor">#</a> Solution</h3> <ul><li>Usage of secure libraries that only allow certain <code>alg</code> values</li> <li>Usage of other authentication methods</li></ul> <h2 id="technology"><a href="#technology" class="header-anchor">#</a> Technology</h2> <div class="custom-block danger"><p class="custom-block-title">DANGER</p> <p><strong>All problems except the first two are native to JWTs and not solvable</strong></p></div> <h3 id="node-js-libraries"><a href="#node-js-libraries" class="header-anchor">#</a> Node.js Libraries</h3> <p>The first of the above described problems is solved through the <a href="https://www.npmjs.com/package/jsonwebtoken" target="_blank" rel="noopener noreferrer">jsonwebtoken<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> library. The parameter that is passed to the  <em>verify</em> method is evaluated whether its content is a public key or not. If it is a public key, the RSA encryption is used and if not, the string is used as secret and only HMAC based encryption is used.</p> <h3 id="java"><a href="#java" class="header-anchor">#</a> Java</h3> <p>The libraries available in Java <a href="https://mvnrepository.com/artifact/io.jsonwebtoken/jjwt" target="_blank" rel="noopener noreferrer">io.jsonwebtoken<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> or <a href="https://mvnrepository.com/artifact/com.auth0/java-jwt" target="_blank" rel="noopener noreferrer">java-jwt<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> work similar.</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/owasp2021/A7-IdentificationAndAuthenticationFailures/" class="prev router-link-active">
        General Information
      </a></span> <span class="next"><a href="/owasp2021/A7-IdentificationAndAuthenticationFailures/passwordHashing.html">
        Passwort Hashing
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.092ee17f.js" defer></script><script src="/assets/js/2.480740af.js" defer></script><script src="/assets/js/31.788e2c0c.js" defer></script><script src="/assets/js/4.6976baea.js" defer></script>
  </body>
</html>
