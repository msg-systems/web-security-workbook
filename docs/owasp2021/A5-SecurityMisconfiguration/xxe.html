<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>XML External Entities (XXE) | Web Security Workbook</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo.svg">
    <meta name="description" content="Workbook for secure web-applications">
    
    <link rel="preload" href="/assets/css/0.styles.7a69eaf4.css" as="style"><link rel="preload" href="/assets/js/app.0d4a5cd6.js" as="script"><link rel="preload" href="/assets/js/2.480740af.js" as="script"><link rel="preload" href="/assets/js/30.44518d95.js" as="script"><link rel="preload" href="/assets/js/4.427d56c9.js" as="script"><link rel="prefetch" href="/assets/js/10.ffd738e0.js"><link rel="prefetch" href="/assets/js/11.53d5a4dd.js"><link rel="prefetch" href="/assets/js/12.f96d5720.js"><link rel="prefetch" href="/assets/js/13.48f70e2c.js"><link rel="prefetch" href="/assets/js/14.379796fd.js"><link rel="prefetch" href="/assets/js/15.2becb35e.js"><link rel="prefetch" href="/assets/js/16.5cdb6f07.js"><link rel="prefetch" href="/assets/js/17.091fba78.js"><link rel="prefetch" href="/assets/js/18.efa8ecc6.js"><link rel="prefetch" href="/assets/js/19.12e08c1b.js"><link rel="prefetch" href="/assets/js/20.78d8fa11.js"><link rel="prefetch" href="/assets/js/21.c2550716.js"><link rel="prefetch" href="/assets/js/22.cd9ccdec.js"><link rel="prefetch" href="/assets/js/23.9d28d7a2.js"><link rel="prefetch" href="/assets/js/24.5d708541.js"><link rel="prefetch" href="/assets/js/25.0b0882f4.js"><link rel="prefetch" href="/assets/js/26.17253c08.js"><link rel="prefetch" href="/assets/js/27.23c17c27.js"><link rel="prefetch" href="/assets/js/28.fc270122.js"><link rel="prefetch" href="/assets/js/29.432d4814.js"><link rel="prefetch" href="/assets/js/3.2d28240e.js"><link rel="prefetch" href="/assets/js/31.98f1996e.js"><link rel="prefetch" href="/assets/js/32.ae3da5c4.js"><link rel="prefetch" href="/assets/js/33.09eb088e.js"><link rel="prefetch" href="/assets/js/34.120e659f.js"><link rel="prefetch" href="/assets/js/35.4c2b60f4.js"><link rel="prefetch" href="/assets/js/36.bff69253.js"><link rel="prefetch" href="/assets/js/37.92238fc6.js"><link rel="prefetch" href="/assets/js/38.b9691323.js"><link rel="prefetch" href="/assets/js/39.7e54b5cf.js"><link rel="prefetch" href="/assets/js/40.c9d80074.js"><link rel="prefetch" href="/assets/js/41.e2d9417d.js"><link rel="prefetch" href="/assets/js/5.5a7c7628.js"><link rel="prefetch" href="/assets/js/6.16ef11dd.js"><link rel="prefetch" href="/assets/js/7.43b93d5e.js"><link rel="prefetch" href="/assets/js/8.b4f8ad6b.js"><link rel="prefetch" href="/assets/js/9.c77f72a2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.7a69eaf4.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.svg" alt="Web Security Workbook" class="logo"> <span class="site-name can-hide">Web Security Workbook</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/owasp2021/" class="nav-link router-link-active">
  OWASP 2021
</a></div><div class="nav-item"><a href="/general/" class="nav-link">
  General
</a></div><div class="nav-item"><a href="/codeExamples.html" class="nav-link">
  Code Examples
</a></div><div class="nav-item"><a href="/imprint.html" class="nav-link">
  Imprint
</a></div><div class="nav-item"><a href="https://www.msg.group/en/privacy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Data Privacy
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/owasp2021/" class="nav-link router-link-active">
  OWASP 2021
</a></div><div class="nav-item"><a href="/general/" class="nav-link">
  General
</a></div><div class="nav-item"><a href="/codeExamples.html" class="nav-link">
  Code Examples
</a></div><div class="nav-item"><a href="/imprint.html" class="nav-link">
  Imprint
</a></div><div class="nav-item"><a href="https://www.msg.group/en/privacy" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Data Privacy
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/owasp2021/" aria-current="page" class="sidebar-link">OWASP Top 10 2021</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>A1: Broken Access Control</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>A2: Cryptographic Failures</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>A3: Injection</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>A4: Insecure Design</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>A5: Security Misconfiguration</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/owasp2021/A5-SecurityMisconfiguration/" aria-current="page" class="sidebar-link">General Information</a></li><li><a href="/owasp2021/A5-SecurityMisconfiguration/errorHandling.html" class="sidebar-link">Error Handling</a></li><li><a href="/owasp2021/A5-SecurityMisconfiguration/httpHeader.html" class="sidebar-link">HTTP Headers</a></li><li><a href="/owasp2021/A5-SecurityMisconfiguration/xxe.html" aria-current="page" class="active sidebar-link">XML External Entities (XXE)</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>A6: Vulnerable and Outdated Components</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>A7: Identification and Authentication Failures</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>A8: Software and Data Integrity Failures</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>A9: Security Logging and Monitoring Failures</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>A10: Server-Side Request Forgery (SSRF)</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="page-title"><a href="#page-title" class="header-anchor">#</a> XML External Entities (XXE)</h1> <p>If XML parser are configured incorrectly attackers can exploit them by defining external entities to either read data or to execute denial of service attacks.</p> <span class="badge tip" style="vertical-align:top;" data-v-15b7b770>A05:2021</span> <h2 id="background"><a href="#background" class="header-anchor">#</a> Background</h2> <h3 id="context"><a href="#context" class="header-anchor">#</a> Context</h3> <p>XXE attacks are possible if the used XML parser is not configured securely. In case the referencing of external entities is allowed security issues can arise. Entities are defined in the following format:</p> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">error</span> <span class="token attr-name">&quot;An</span> <span class="token attr-name">error</span> <span class="token attr-name">occured&quot;</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p>Via <code>&amp;error;</code> the entity can be used inside of the XML document.</p> <h3 id="problems"><a href="#problems" class="header-anchor">#</a> Problems</h3> <ul><li>Through recursive referencing on entities attackers can increase CPU usage and make the server unresponsive. The Billion Laughs Attack is an attack which uses this pattern to deny a server's service. It references <code>&amp;LOLX;</code> entities over and over as seen in the example below:</li></ul> <div class="language-xml extra-class"><pre class="language-xml"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">root</span> <span class="token punctuation">[</span><span class="token internal-subset">
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ELEMENT</span> <span class="token attr-name">root</span> <span class="token attr-name">ANY</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">LOL</span> <span class="token attr-name">&quot;lol&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">LOL1</span> <span class="token attr-name">&quot;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&amp;LOL;&quot;</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">LOL2</span> <span class="token attr-name">&quot;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;&amp;LOL1;</span>
<span class="token attr-name">6</span> <span class="token attr-name">&amp;LOL1;&quot;</span><span class="token punctuation">&gt;</span></span>
...
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>!ENTITY</span> <span class="token attr-name">LOL9</span> <span class="token attr-name">&quot;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;&amp;LOL8;</span>
<span class="token attr-name">&amp;LOL8;&quot;</span><span class="token punctuation">&gt;</span></span>
</span><span class="token punctuation">]</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>root</span><span class="token punctuation">&gt;</span></span><span class="token entity named-entity" title="&amp;LOL9;">&amp;LOL9;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>root</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><ul><li>Additionally, the <em>SYSTEM</em> keyword can be used to load external files or read internal data such as passwords</li></ul> <div class="language- extra-class"><pre class="language-text"><code>  &lt;!ENTITY xxe SYSTEM &quot;file:///etc/passwd&quot; &gt;]&gt;
</code></pre></div><h3 id="solutions"><a href="#solutions" class="header-anchor">#</a> Solutions</h3> <ul><li>Restrict the parsers underlying resources</li> <li>Use parsers that contain security mechanisms that <strong>ignore external entities</strong></li></ul> <h2 id="technologies"><a href="#technologies" class="header-anchor">#</a> Technologies</h2> <p>Your favorite parser is missing? <a href="https://websecurityworkbook.com" target="_blank" rel="noopener noreferrer">Add it yourself!<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p>As described above, the parser should not be exploitable by external entities.</p> <h3 id="node-js"><a href="#node-js" class="header-anchor">#</a> Node.js</h3> <table><thead><tr><th>Library</th> <th>Solution</th></tr></thead> <tbody><tr><td><em>sax</em></td> <td>Setting its mode to <em>strict</em> is required. <a href="https://github.com/moritzhuether/mastersthesis/blob/main/GeneralJS/xxe.js" target="_blank" rel="noopener noreferrer">Code example<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></td></tr></tbody></table> <h3 id="java"><a href="#java" class="header-anchor">#</a> Java</h3> <p>See <a href="https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html#java" target="_blank" rel="noopener noreferrer">OWASP's Cheat Sheet<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/owasp2021/A5-SecurityMisconfiguration/httpHeader.html" class="prev">
        HTTP Headers
      </a></span> <span class="next"><a href="/owasp2021/A6-VulnerableAndOutdatedComponents/">
        Vulnerable and Outdated Components
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.0d4a5cd6.js" defer></script><script src="/assets/js/2.480740af.js" defer></script><script src="/assets/js/30.44518d95.js" defer></script><script src="/assets/js/4.427d56c9.js" defer></script>
  </body>
</html>
